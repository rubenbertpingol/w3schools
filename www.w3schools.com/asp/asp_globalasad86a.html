<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en-US" xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from www.w3schools.com/asp/asp_globalasa.asp?output=print by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 15 Oct 2011 23:16:49 GMT -->
<head>

<title>ASP Global.asa</title>
 
<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon" />
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
<meta name="Keywords" content="html,css,tutorial,html5,dhtml,css3,xsl,xslt,xhtml,javascript,jquery,asp,ado,net,vbscript,dom,sql,colors,soap,php,rss,authoring,programming,training,learning,quiz,beginner's guide,primer,lessons,school,howto,reference,examples,samples,source code,tags,demos,tips,links,FAQ,tag list,forms,frames,color table,w3c,cascading style sheets,active server pages,dynamic html,internet,database,development,Web building,Webmaster,html guide" />

<meta name="Description" content="Free HTML XHTML CSS JavaScript jQuery XML DOM XSL XSLT RSS AJAX ASP .NET PHP SQL tutorials, references, examples for web building." />

<link rel="stylesheet" type="text/css" href="../stdtheme.css" />
<script type="text/javascript">
<!--
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
//-->
</script>
<script type="text/javascript">
<!--
function searchfield_focus(obj)
{
obj.style.color=""
obj.style.fontStyle=""
if (obj.value=="Search w3schools.com")
	{
	obj.value=""
	}
}

var pageTracker = _gat._getTracker("UA-3855518-1");
pageTracker._initData();
pageTracker._trackPageview();

var addr=document.location.href;
function displayError()
{
document.getElementById("err_url").value=addr;
document.getElementById("err_form").style.display="block";
document.getElementById("err_desc").focus();
hideSent();
}
function hideError()
{
document.getElementById("err_form").style.display="none";
}
function hideSent()
{
document.getElementById("err_sent").style.display="none";
}
function sendErr()
{
var xmlhttp;
var err_url=document.getElementById("err_url").value;
var err_email=document.getElementById("err_email").value;
var err_desc=document.getElementById("err_desc").value;
if (window.XMLHttpRequest)
  {// code for IE7+, Firefox, Chrome, Opera, Safari
  xmlhttp=new XMLHttpRequest();
  }
else
  {// code for IE6, IE5
  xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }

xmlhttp.open("POST","../err_sup.html",true);
xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xmlhttp.send("err_url=" + err_url + "&err_email=" + err_email + "&err_desc=" + escape(err_desc));
hideError();
document.getElementById("err_sent").style.display="block";
}

function click_expandingMenuHeader(obj,sectionName)
{
var x=document.getElementById("cssprop_" + sectionName).parentNode.className;
if (x.indexOf("expandingMenuNotSelected")>-1)
	{
	x=x.replace("expandingMenuNotSelected","expandingMenuSelected");
	document.getElementById("cssprop_" + sectionName).parentNode.className=x;
	document.getElementById("cssprop_" + sectionName).style.display="block";
	}
else
	{
	x=x.replace("expandingMenuSelected","expandingMenuNotSelected");
	document.getElementById("cssprop_" + sectionName).parentNode.className=x;
	document.getElementById("cssprop_" + sectionName).style.display="none";
	}
}

//-->
</script>
<!--[if lt IE 7]>
<style>
#leftcolumn{margin-left:0}
</style>
<![endif]-->
</head>
<body>

<p>From <b>http://www.w3schools.com</b> (Copyright Refsnes Data)</p>

<h1>ASP <span class="color_h1">The Global.asa file</span></h1>
<div class="chapter">
<div class="prev"><a class="chapter" href="asp_incfiles.html">&laquo; Previous</a></div>
<div class="next"><a class="chapter" href="asp_send_email.html">Next Chapter &raquo;</a></div>
</div>
<hr />
<h2>The Global.asa file</h2>
<p>The Global.asa file is an optional file that can contain declarations of objects, variables, and methods that
can be accessed by every page in an ASP application.</p>
<p>All valid browser scripts (JavaScript, VBScript, JScript, PerlScript, etc.) can be used within Global.asa.</p>

<p>The Global.asa file can contain only the following:</p>
<ul>
  <li>Application events</li>
  <li>Session events</li>
  <li>&lt;object&gt; declarations</li>
  <li>TypeLibrary declarations</li>
  <li>the #include directive</li>
</ul>

<p><b>Note:</b> The Global.asa file must be stored in the root directory of the
ASP application, and each application can only have one Global.asa file.</p>
<hr />

<h2>Events in Global.asa</h2>
<p>In  Global.asa you can tell the application and session objects what to do when the application/session starts and what to do when the
application/session ends. The code for this is placed in event handlers. The Global.asa file can contain four types of events:</p>
<b>Application_OnStart</b> - Occurs when the FIRST user calls the first page in an ASP application. This event occurs after the
Web server is restarted or after the Global.asa file is edited. The &quot;Session_OnStart&quot; event occurs immediately after this event.
<p><b>Session_OnStart</b> - This event occurs EVERY time a NEW user requests his or her first page in the ASP application.</p>
<p><b>Session_OnEnd</b> - This event occurs EVERY time a user ends a session. A user-session ends after a page has not been requested by the user for a 
specified time (by default this is 20 minutes).</p>
<p><b>Application_OnEnd</b> - This event occurs after the LAST user has ended the session. Typically, this event occurs when a Web server stops.
This procedure is used to clean up settings after the Application stops, like delete records or write information to text files.</p>
<p>A Global.asa file could look something like this:</p>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
&lt;script language=&quot;vbscript&quot; runat=&quot;server&quot;&gt;<br /><br />
sub Application_OnStart<br />
  '<i>some code</i><br />
end sub<br /><br />
sub Application_OnEnd<br />
  '<i>some code</i><br />
end sub<br /><br />
sub Session_OnStart<br />
  '<i>some code</i><br />
end sub<br /><br />
sub Session_OnEnd<br />
  '<i>some code</i><br />
end sub<br /><br />
&lt;/script&gt;</td></tr></table>

<p><b>Note:</b> Because we cannot use the ASP script delimiters (&lt;% and %&gt;) to insert scripts in the Global.asa file, we put subroutines inside an HTML 
&lt;script&gt; element.</p>
<hr />

<h2>&lt;object&gt; Declarations</h2>
<p>It is possible to create objects with session or application scope in Global.asa by using the &lt;object&gt; tag.</p>
<p><b>Note:</b> The &lt;object&gt; tag should be outside the &lt;script&gt; tag!</p>

<h3>Syntax</h3>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
&lt;object runat=&quot;server&quot; scope=&quot;<i>scope</i>&quot; id=&quot;<i>id</i>&quot;
{progid=&quot;<i>progID</i>&quot;|classid=&quot;<i>classID</i>&quot;}&gt;<br />
....<br />
&lt;/object&gt;</td></tr></table>

<br />
<table class="reference">
  <tr>
    <th align="left" valign="top" width="20%">Parameter</th>
    <th align="left" valign="top" width="80%">Description</th>
  </tr>  
  <tr>
    <td valign="top">scope </td>
    <td valign="top">Sets the scope of the object (either Session or Application)</td>
  </tr>
  <tr>
    <td valign="top">id </td>
    <td valign="top">Specifies a unique id for the object</td>
  </tr>
  <tr>
    <td valign="top">ProgID </td>
    <td valign="top">An id associated with a class id. The format for ProgID is [Vendor.]Component[.Version]
    <p> Either ProgID or ClassID must be specified.</p></td>
  </tr>
  <tr>
    <td valign="top">ClassID </td>
    <td valign="top">Specifies a unique id for a COM class object.<p> Either ProgID or ClassID must be specified.</p></td>
  </tr>
</table>

<h3>Examples</h3>
<p>The first example creates an object of session scope named &quot;MyAd&quot; by using the ProgID parameter:</p>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>&lt;object runat=&quot;server&quot; scope=&quot;session&quot; id=&quot;MyAd&quot;
progid=&quot;MSWC.AdRotator&quot;&gt;<br />
&lt;/object&gt;</td></tr></table>

<p>The second example creates an object of application scope named &quot;MyConnection&quot; by using the ClassID parameter:</p>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
&lt;object runat=&quot;server&quot; scope=&quot;application&quot; id=&quot;MyConnection&quot;<br />
classid=&quot;Clsid:8AD3067A-B3FC-11CF-A560-00A0C9081C21&quot;&gt;<br />
&lt;/object&gt;</td></tr></table>

<p>The objects declared in the Global.asa file can be used by any script in the application:</p>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
GLOBAL.ASA:<br /><br />
&lt;object runat=&quot;server&quot; scope=&quot;session&quot; id=&quot;MyAd&quot;
progid=&quot;MSWC.AdRotator&quot;&gt;<br />
&lt;/object&gt;<br /><br />
You could reference the object &quot;MyAd&quot; from any page in the ASP application:<br /><br />
SOME .ASP FILE:<br /><br />
&lt;%=MyAd.GetAdvertisement(&quot;/banners/adrot.txt&quot;)%&gt;</td></tr></table>
<br />
<hr />

<h2>TypeLibrary Declarations</h2>
<p>A TypeLibrary is a container for the contents of a DLL file corresponding to a COM object. By including a call to the TypeLibrary in the Global.asa file,
the constants of the COM object can be accessed, and errors can be better reported by the ASP code. If your Web application relies on COM objects that have
declared data types in type libraries, you can declare the type libraries in Global.asa.</p>

<h3>Syntax</h3>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
&lt;!--METADATA TYPE=&quot;TypeLib&quot;<br />
file=&quot;<i>filename</i>&quot;
uuid=&quot;<i>id</i>&quot;
version=&quot;<i>number</i>&quot;
lcid=&quot;<i>localeid</i>&quot;<br />
--&gt;</td></tr></table>
<br />

<table class="reference">
  <tr>
    <th align="left" valign="top" width="20%">Parameter</th>
    <th align="left" valign="top" width="80%">Description</th>
  </tr>  
  <tr>
    <td valign="top">file</td>
    <td valign="top">Specifies an absolute path to a type library.
      <p>Either the file parameter or the uuid parameter is required</p></td>
  </tr>
  <tr>
    <td valign="top">uuid</td>
    <td valign="top">Specifies a unique identifier for the type library.
      <p>Either the file parameter or the uuid parameter is required</p></td>
  </tr>
  <tr>
    <td valign="top">version</td>
    <td valign="top">Optional. Used for selecting version. If the requested version is not found, then the most recent version is used</td>
  </tr>
  <tr>
    <td valign="top">lcid</td>
    <td valign="top">Optional. The locale identifier to be used for the type library</td>
  </tr>
</table>

<h3>Error Values</h3>

<p>The server can return one of the following error messages:</p>

<table class="reference">
  <tr>
    <th align="left" valign="top" width="20%">Error Code</th>
    <th align="left" valign="top" width="80%">Description</th>
  </tr>  
  <tr>
    <td valign="top">ASP 0222</td>
    <td valign="top"> Invalid type library specification</td>
  </tr>
  <tr>
    <td valign="top">ASP 0223</td>
    <td valign="top"> Type library not found</td>
  </tr>
  <tr>
    <td valign="top">ASP 0224</td>
    <td valign="top"> Type library cannot be loaded</td>
  </tr>
  <tr>
    <td valign="top">ASP 0225</td>
    <td valign="top"> Type library cannot be wrapped</td>
  </tr>
</table>

<p><b>Note:</b> METADATA tags can appear anywhere in the Global.asa file (both inside and outside &lt;script&gt; tags). However, it is recommended that
METADATA tags appear near the top of the Global.asa file.</p>
<hr />

<h2>Restrictions</h2>
<p>Restrictions on what you can include in the Global.asa file:</p>
<ul>
  <li> You cannot display text written in the Global.asa file. This file can't display information</li>
  <li>You can only use Server and Application objects in the Application_OnStart and Application_OnEnd
subroutines. In the&nbsp;Session_OnEnd subroutine, you can use Server, Application, and Session
    objects. In the Session_OnStart subroutine you can use any built-in object</li>
</ul>
<hr />

<h2>How to use the Subroutines</h2>
<p>Global.asa is often used to initialize variables.&nbsp;</p>
<p> The example below shows how to detect the exact time a visitor first arrives on a Web site. The time is stored in a Session variable named 
&quot;started&quot;, and the value of the &quot;started&quot; variable can be accessed from any ASP page in the application:</p>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
&lt;script language=&quot;vbscript&quot; runat=&quot;server&quot;&gt;<br />
sub Session_OnStart<br />
Session(&quot;started&quot;)=now()<br />
end sub<br />
&lt;/script&gt;</td></tr></table>

<p>Global.asa can also be used to control page access.</p>

<p>The example below shows how to redirect every new visitor to another page, in this case to a
page called &quot;newpage.asp&quot;:</p>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
&lt;script language=&quot;vbscript&quot; runat=&quot;server&quot;&gt;<br />
sub Session_OnStart<br />
Response.Redirect(&quot;newpage.asp&quot;)<br />
end sub<br />
&lt;/script&gt;</td></tr></table>

<p>And you can include functions in the Global.asa file.</p>
<p>In the example below the Application_OnStart subroutine occurs when the Web server starts. Then
the Application_OnStart subroutine calls another subroutine named &quot;getcustomers&quot;.
The &quot;getcustomers&quot; subroutine opens a database and retrieves a record set from
the &quot;customers&quot; table. The record set is assigned to an array, where it
can be accessed from any ASP page without querying the database:</p>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
&lt;script language=&quot;vbscript&quot; runat=&quot;server&quot;&gt;<br /><br />
sub Application_OnStart<br />
getcustomers<br />
end sub<br /><br />
sub getcustomers<br />
set conn=Server.CreateObject(&quot;ADODB.Connection&quot;)<br />
conn.Provider=&quot;Microsoft.Jet.OLEDB.4.0&quot;<br />
conn.Open &quot;c:/webdata/northwind.mdb&quot;<br />
set rs=conn.execute(&quot;select name from customers&quot;)<br />
Application(&quot;customers&quot;)=rs.GetRows<br />
rs.Close<br />
conn.Close<br />
end sub<br /><br />
&lt;/script&gt;</td></tr></table>
<br />
<hr />

<h2>Global.asa Example</h2>
<p>In this example we will create a Global.asa file that counts the number of current visitors.</p>
<ul>
  <li>The Application_OnStart sets the Application variable &quot;visitors&quot; to 0 when the server starts</li>
  <li>The Session_OnStart subroutine adds one to the variable &quot;visitors&quot; every time a new visitor arrives</li>
  <li>The Session_OnEnd subroutine subtracts one from &quot;visitors&quot; each time this subroutine is triggered</li>
</ul>
<p>The Global.asa file:</p>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
&lt;script language=&quot;vbscript&quot; runat=&quot;server&quot;&gt;<br /><br />
Sub Application_OnStart<br />
Application(&quot;visitors&quot;)=0<br />
End Sub<br /><br />
Sub Session_OnStart<br />
Application.Lock<br />
Application(&quot;visitors&quot;)=Application(&quot;visitors&quot;)+1<br />
Application.UnLock<br />
End Sub<br /><br />
Sub Session_OnEnd<br />
Application.Lock<br />
Application(&quot;visitors&quot;)=Application(&quot;visitors&quot;)-1<br />
Application.UnLock<br />
End Sub<br /><br />
&lt;/script&gt;</td></tr></table>

<p>To display the number of current visitors in an ASP file:</p>

<table class="code notranslate" cellspacing="0" cellpadding="0" border="0" width="100%">
<tr><td>
&lt;html&gt;<br />
&lt;head&gt;<br />
&lt;/head&gt;<br />
&lt;body&gt;<br />
&lt;p&gt;There are &lt;%response.write(Application(&quot;visitors&quot;))%&gt;
online now!&lt;/p&gt;<br />
&lt;/body&gt;<br />
&lt;/html&gt;</td></tr></table>
<br />
<div class="chapter">
<div class="prev"><a class="chapter" href="asp_incfiles.html">&laquo; Previous</a></div>
<div class="next"><a class="chapter" href="asp_send_email.html">Next Chapter &raquo;</a></div>
</div>

<p>From <b>http://www.w3schools.com</b> (Copyright Refsnes Data)</p>

</body>

<!-- Mirrored from www.w3schools.com/asp/asp_globalasa.asp?output=print by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 15 Oct 2011 23:16:49 GMT -->
</html>